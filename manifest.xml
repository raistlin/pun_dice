<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE extension SYSTEM "ext-1.0.dtd">

<!--
/**
 * Allows users to create rolling dices
 *
 * @copyright Copyright (C) 2009 Raul Ferriz
 * @license http://www.gnu.org/licenses/gpl.html GPL version 3
 * @package pun_dice
 *
 * Changelog
 *  v0.3 Added support for conditions checks
 *  v0.2 Fix include of functions file
 *  v0.1 Initial release
 */
-->

<extension engine="1.0">
	<id>pun_dice</id>
	<title>Pun dice roller</title>
	<version>0.3</version>
	<description>Adds dice rolle feature for topics.</description>
	<author>Ra√∫l Ferriz Candela</author>
	<minversion>1.3</minversion>
	<maxtestedon>1.3.3</maxtestedon>
	<install></install>
	<uninstall></uninstall>
	<hooks>
		<hook id="co_common"><![CDATA[
			$pun_extensions_used = array_merge(isset($pun_extensions_used) ? $pun_extensions_used : array(), array($ext_info['id']));

			// Include language files
			if (file_exists($ext_info['path'].'/lang/'.$forum_user['language'].'/'.$ext_info['id'].'.php'))
				include_once $ext_info['path'].'/lang/'.$forum_user['language'].'/'.$ext_info['id'].'.php';
			else
				include_once $ext_info['path'].'/lang/English/'.$ext_info['id'].'.php';

			// We need to include early the functions
			include $ext_info['path'].'/functions.php';

			// Sets global active post
			$dr_active_post = 0;

		]]></hook>
		<hook id="ed_main_output_start"><![CDATA[

			global $dr_active_post;
			$dr_active_post = $id;
		]]></hook>
		<hook id="vt_post_loop_start, po_topic_review_pre_item_indent_merge"><![CDATA[

			global $dr_active_post;
			$dr_active_post = $cur_post['id'];
		]]></hook>
		<hook id="ps_preparse_tags_start"><![CDATA[
			$tags[] = 'dice';
			$tags_opened[] = 'dice';
			$tags_closed[] = 'dice';
			$tags_inline[] = 'dice';
			$tags_limit_bbcode['*'][] = 'dice';
			$tags_limit_bbcode['url'][] = 'dice';
			$tags_limit_bbcode['email'][] = 'dice';
		]]></hook>
		<hook id="ps_do_bbcode_replace"><![CDATA[

			$pattern[] = '#\[dice\](.*?)\[/dice\]#ms';
			$replace[] = '<strong><!--PUN_DICE 0.3-->$1<!--PUN_DICE 0.3--></strong>';

			$text = dr_parse($text);
		]]></hook>
	<hooks>
</extension>


